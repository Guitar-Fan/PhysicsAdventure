<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Adventure - Debug Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/particles.js/2.0.0/particles.min.js"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen">
    <div id="particles-js" class="fixed inset-0 z-0"></div>
    
    <div class="relative z-10 p-8">
        <h1 class="text-4xl font-bold text-center mb-8 text-blue-400">Physics Adventure - Debug Test</h1>
        
        <div class="grid grid-cols-2 gap-8">
            <!-- Debug Info -->
            <div class="bg-slate-800 p-6 rounded-lg">
                <h3 class="text-xl font-bold mb-4 text-green-400">Debug Info</h3>
                <div id="debugInfo" class="space-y-2 text-sm font-mono">
                    <div>Loading...</div>
                </div>
            </div>
            
            <!-- Game Controls -->
            <div class="bg-slate-800 p-6 rounded-lg">
                <h3 class="text-xl font-bold mb-4 text-blue-400">Game Controls</h3>
                <div class="space-y-4">
                    <button id="startGame" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded font-bold transition-colors">
                        Start Physics Game
                    </button>
                    <button id="testSweetAlert" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded font-bold transition-colors">
                        Test SweetAlert2
                    </button>
                    <button id="testGSAP" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded font-bold transition-colors">
                        Test GSAP Animation
                    </button>
                    <button id="clearObjects" class="w-full bg-red-600 hover:bg-red-700 px-4 py-2 rounded font-bold transition-colors">
                        Clear Physics Objects
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Game Canvas -->
        <div class="mt-8 bg-slate-800 p-6 rounded-lg">
            <h3 class="text-xl font-bold mb-4 text-yellow-400">Physics Simulation</h3>
            <canvas id="gameCanvas" width="800" height="400" class="border border-gray-600 rounded bg-black/50 w-full"></canvas>
            <p class="text-sm text-gray-400 mt-2">Click on the canvas to create physics objects!</p>
        </div>
        
        <!-- Physics Data -->
        <div class="mt-8 bg-slate-800 p-6 rounded-lg">
            <h3 class="text-xl font-bold mb-4 text-orange-400">Physics Data</h3>
            <div id="physicsDataContainer" class="grid grid-cols-4 gap-4 text-sm">
                <div class="bg-blue-900/20 p-3 rounded border border-blue-500/30">
                    <div class="text-blue-400 font-bold">Gravity</div>
                    <div id="gravityDisplay" class="text-white">9.8 m/s²</div>
                </div>
                <div class="bg-green-900/20 p-3 rounded border border-green-500/30">
                    <div class="text-green-400 font-bold">Objects</div>
                    <div id="objectsDisplay" class="text-white">0</div>
                </div>
                <div class="bg-purple-900/20 p-3 rounded border border-purple-500/30">
                    <div class="text-purple-400 font-bold">Energy</div>
                    <div id="energyDisplay" class="text-white">0 J</div>
                </div>
                <div class="bg-yellow-900/20 p-3 rounded border border-yellow-500/30">
                    <div class="text-yellow-400 font-bold">Time</div>
                    <div id="timeDisplay" class="text-white">0.0 s</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Debug logging
        const debugLog = (message) => {
            console.log(message);
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            debugInfo.scrollTop = debugInfo.scrollHeight;
        };

        // Global variables
        let physicsEngine = null;
        let gameWorld = null;
        let gameRender = null;
        let gameRunner = null;
        let physicsBodies = [];
        let isGameRunning = false;

        // Initialize debug test
        document.addEventListener('DOMContentLoaded', () => {
            debugLog('✅ DOM Content Loaded');
            
            // Check external libraries
            debugLog(`Matter.js: ${typeof Matter !== 'undefined' ? '✅ Loaded' : '❌ Missing'}`);
            debugLog(`GSAP: ${typeof gsap !== 'undefined' ? '✅ Loaded' : '❌ Missing'}`);
            debugLog(`SweetAlert2: ${typeof Swal !== 'undefined' ? '✅ Loaded' : '❌ Missing'}`);
            debugLog(`Particles.js: ${typeof particlesJS !== 'undefined' ? '✅ Loaded' : '❌ Missing'}`);
            
            // Initialize components
            initializeParticles();
            initializeEventListeners();
            
            debugLog('🎮 Debug test ready!');
        });
        
        function initializeParticles() {
            if (typeof particlesJS !== 'undefined') {
                particlesJS('particles-js', {
                    particles: {
                        number: { value: 80 },
                        color: { value: "#3b82f6" },
                        shape: { type: "circle" },
                        opacity: { value: 0.3, random: true },
                        size: { value: 2, random: true },
                        line_linked: {
                            enable: true,
                            distance: 150,
                            color: "#3b82f6",
                            opacity: 0.2,
                            width: 1
                        },
                        move: {
                            enable: true,
                            speed: 1,
                            direction: "none",
                            random: true
                        }
                    },
                    interactivity: {
                        detect_on: "canvas",
                        events: {
                            onhover: { enable: true, mode: "grab" },
                            onclick: { enable: true, mode: "push" }
                        }
                    },
                    retina_detect: true
                });
                debugLog('✨ Particles.js initialized');
            }
        }
        
        function initializeEventListeners() {
            // Start Game Button
            document.getElementById('startGame').addEventListener('click', startPhysicsGame);
            
            // Test SweetAlert2
            document.getElementById('testSweetAlert').addEventListener('click', () => {
                Swal.fire({
                    title: 'SweetAlert2 Test!',
                    text: 'This modal is working perfectly!',
                    icon: 'success',
                    background: '#1e293b',
                    color: '#e2e8f0',
                    confirmButtonColor: '#3b82f6'
                });
                debugLog('🍭 SweetAlert2 test executed');
            });
            
            // Test GSAP Animation
            document.getElementById('testGSAP').addEventListener('click', () => {
                const canvas = document.getElementById('gameCanvas');
                gsap.to(canvas, {
                    duration: 1,
                    rotation: 360,
                    scale: 1.1,
                    ease: "bounce.out",
                    onComplete: () => {
                        gsap.set(canvas, { rotation: 0, scale: 1 });
                    }
                });
                debugLog('✨ GSAP animation test executed');
            });
            
            // Clear Objects
            document.getElementById('clearObjects').addEventListener('click', clearPhysicsObjects);
        }
        
        function startPhysicsGame() {
            debugLog('🚀 Starting physics game...');
            
            const canvas = document.getElementById('gameCanvas');
            if (!canvas) {
                debugLog('❌ Canvas not found!');
                return;
            }
            
            // Create Matter.js engine
            physicsEngine = Matter.Engine.create();
            gameWorld = physicsEngine.world;
            
            // Create renderer
            gameRender = Matter.Render.create({
                canvas: canvas,
                engine: physicsEngine,
                options: {
                    width: 800,
                    height: 400,
                    wireframes: false,
                    background: 'transparent',
                    showAngleIndicator: false,
                    showVelocity: false
                }
            });
            
            // Create ground
            const ground = Matter.Bodies.rectangle(400, 380, 800, 40, { 
                isStatic: true,
                render: { fillStyle: '#374151' }
            });
            Matter.World.add(gameWorld, ground);
            
            // Start renderer and runner
            Matter.Render.run(gameRender);
            gameRunner = Matter.Runner.create();
            Matter.Runner.run(gameRunner, physicsEngine);
            
            // Add click interaction
            canvas.addEventListener('click', (event) => {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                
                createPhysicsObject(x, y);
            });
            
            isGameRunning = true;
            updatePhysicsDisplay();
            
            debugLog('✅ Physics game started successfully!');
        }
        
        function createPhysicsObject(x, y) {
            const colors = ['#3b82f6', '#ef4444', '#10b981', '#f59e0b', '#8b5cf6'];
            const shapes = ['circle', 'rectangle'];
            
            const shape = shapes[Math.floor(Math.random() * shapes.length)];
            const color = colors[Math.floor(Math.random() * colors.length)];
            const size = 15 + Math.random() * 25;
            
            let body;
            if (shape === 'circle') {
                body = Matter.Bodies.circle(x, y, size);
            } else {
                body = Matter.Bodies.rectangle(x, y, size, size);
            }
            
            // Style the body
            body.render.fillStyle = color;
            body.render.strokeStyle = '#ffffff';
            body.render.lineWidth = 2;
            
            // Add physics properties
            Matter.Body.set(body, {
                restitution: 0.3 + Math.random() * 0.5,
                friction: 0.1 + Math.random() * 0.8
            });
            
            Matter.World.add(gameWorld, body);
            physicsBodies.push(body);
            
            debugLog(`📦 Created ${shape} at (${x.toFixed(0)}, ${y.toFixed(0)})`);
            updatePhysicsDisplay();
        }
        
        function clearPhysicsObjects() {
            if (!gameWorld) return;
            
            // Remove all non-static bodies
            const allBodies = Matter.Composite.allBodies(gameWorld);
            const bodiesToRemove = allBodies.filter(body => !body.isStatic);
            
            Matter.World.remove(gameWorld, bodiesToRemove);
            physicsBodies = [];
            
            debugLog(`🧹 Cleared ${bodiesToRemove.length} physics objects`);
            updatePhysicsDisplay();
        }
        
        function updatePhysicsDisplay() {
            if (!isGameRunning) return;
            
            const objectCount = physicsBodies.length;
            const gravity = physicsEngine ? physicsEngine.world.gravity.y * 10 : 9.8;
            
            // Calculate total energy (simplified)
            let totalEnergy = 0;
            physicsBodies.forEach(body => {
                const velocity = Math.sqrt(body.velocity.x * body.velocity.x + body.velocity.y * body.velocity.y);
                const kinetic = 0.5 * body.mass * velocity * velocity;
                const potential = body.mass * gravity * Math.max(0, 400 - body.position.y);
                totalEnergy += kinetic + potential;
            });
            
            // Update displays
            document.getElementById('gravityDisplay').textContent = `${gravity.toFixed(1)} m/s²`;
            document.getElementById('objectsDisplay').textContent = objectCount.toString();
            document.getElementById('energyDisplay').textContent = `${totalEnergy.toFixed(0)} J`;
            document.getElementById('timeDisplay').textContent = `${((Date.now() - (window.gameStartTime || Date.now())) / 1000).toFixed(1)} s`;
            
            if (isGameRunning) {
                setTimeout(updatePhysicsDisplay, 100);
            }
        }
        
        // Set game start time
        window.gameStartTime = Date.now();
    </script>
</body>
</html>